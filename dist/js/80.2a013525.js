"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[80],{524:function(e,t,a){a.d(t,{A:function(){return u}});var s=a(6768);const o={class:"text-center"},l=(0,s.Fv)('<div id="loading-wrapper"><div class="spinner"><div class="line1"></div><div class="line2"></div><div class="line3"></div><div class="line4"></div><div class="line5"></div><div class="line6"></div></div></div>',1),r=[l];function n(e,t,a,l,n,i){return(0,s.uX)(),(0,s.CE)("div",o,r)}var i={name:"loader_view"},d=a(1241);const c=(0,d.A)(i,[["render",n]]);var u=c},4463:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});var s=a(6768),o=a(5130),l=a(4232);const r={class:"page-wrapper"},n={class:"main-container"},i={class:"content-wrapper-scroll"},d={class:"content-wrapper"},c={class:"row"},u={class:"col-12"},p={class:"card p-2"},m={class:"row p-2"},f={class:"col-md-6"},b=(0,s.Lk)("label",{class:"mb-1"},"Selecione o período",-1),L=(0,s.Lk)("br",null,null,-1),h={class:"d-flex align-items-center"},A=(0,s.Lk)("b",{class:"me-1"},"DE",-1),g=(0,s.Lk)("b",{class:"mx-1"},"A",-1),v={class:"col-md-6"},k=(0,s.Lk)("label",{class:"text-white mb-1"},".",-1),x=(0,s.Lk)("br",null,null,-1),F=(0,s.Lk)("span",{class:"fas fa-search"},null,-1),D=(0,s.Lk)("span",{class:"fas fa-file-pdf"},null,-1),S=(0,s.Lk)("span",{class:"fas fa-file-code"},null,-1),T={class:"card"},w=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h5",null,"ENTRADAS")],-1),_={class:"card-body"},R=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"bg-secondary"},[(0,s.Lk)("th",null,"DESCRIÇÃO"),(0,s.Lk)("th",null,"ESTUDANTE"),(0,s.Lk)("th",null,"VALOR"),(0,s.Lk)("th",null,"FUNCIONARIO"),(0,s.Lk)("th",null,"DATA")])],-1),C={class:"card-footer"},E={class:"float-end"},O={class:"card"},$=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h5",null,"SAIDAS")],-1),y={class:"card-body"},Y=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"bg-secondary"},[(0,s.Lk)("th",null,"DESCRIÇÃO"),(0,s.Lk)("th",null,"REFERÊNCIA"),(0,s.Lk)("th",null,"VALOR"),(0,s.Lk)("th",null,"FUNCIONARIO"),(0,s.Lk)("th",null,"DATA")])],-1),I={class:"card-footer"},N={class:"float-end"};function P(e,t,a,P,U,z){const H=(0,s.g2)("Sidebar"),M=(0,s.g2)("Navbar"),j=(0,s.g2)("DataTable"),q=(0,s.g2)("Footer"),V=(0,s.g2)("Loader");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(H),(0,s.Lk)("div",n,[(0,s.bF)(M,{page:"Tesouraria / Fluxo de Caixa"}),(0,s.Lk)("div",i,[(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[(0,s.Lk)("div",m,[(0,s.Lk)("div",f,[b,L,(0,s.Lk)("div",h,[A,(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>U.filter_data.start_date=e)},null,512),[[o.Jo,U.filter_data.start_date]]),g,(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>U.filter_data.end_date=e)},null,512),[[o.Jo,U.filter_data.end_date]])])]),(0,s.Lk)("div",v,[k,x,(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>z.filterFluxo&&z.filterFluxo(...e)),class:"btn btn-info text-uppercase fw-bold"},[F,(0,s.eW)(" Filtrar ")]),U.entradas.length>0?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[3]||(t[3]=(...e)=>z.gerarDocumento&&z.gerarDocumento(...e)),class:"btn btn-danger mx-2 text-uppercase fw-bold"},[D,(0,s.eW)(" Imprimir ")])):(0,s.Q3)("",!0),U.entradas.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t[4]||(t[4]=(...e)=>z.exportSAFT&&z.exportSAFT(...e)),class:"btn btn-success text-uppercase fw-bold"},[S,(0,s.eW)(" Exportar SAF-T ")])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",T,[w,(0,s.Lk)("div",_,[(0,s.bF)(j,{ref:"table",data:U.entradas,columns:U.entradasColums,options:{select:!0,language:U.language},class:"display table table-striped table-bordered"},{default:(0,s.k6)((()=>[R])),_:1},8,["data","columns","options"])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",E,[(0,s.Lk)("p",null,[(0,s.eW)("Resultado: "),(0,s.Lk)("b",null,(0,l.v_)(z.numberFormat(U.totalReceita,2,",","."))+"Kz",1)])])])]),(0,s.Lk)("div",O,[$,(0,s.Lk)("div",y,[(0,s.bF)(j,{ref:"table",data:U.despesas,columns:U.saidasColums,options:{select:!0,language:U.language},class:"display table table-striped table-bordered"},{default:(0,s.k6)((()=>[Y])),_:1},8,["data","columns","options"])]),(0,s.Lk)("div",I,[(0,s.Lk)("div",N,[(0,s.Lk)("p",null,[(0,s.eW)("Resultado: "),(0,s.Lk)("b",null,(0,l.v_)(z.numberFormat(U.totalDespesa,2,",","."))+"Kz",1)])])])])])])]),(0,s.bF)(q)]),U.isLoading?((0,s.uX)(),(0,s.Wv)(V,{key:0})):(0,s.Q3)("",!0)])])}a(4603),a(7566),a(8721);var U=a(7532),z=a(3213),H=a(3936),M=a(524),j=a(9715),q=a(9148),V=a.n(q),X=a(903),B=a(9995),K=a(3786),W=a(1749);a(5839);X.A.use(B.A),X.A.use(K.A);var J={name:"fluxo_de_caixa_view",components:{Sidebar:U.A,Navbar:z.A,Footer:H.A,Loader:M.A,DataTable:X.A},data(){return{title:"Fluxo de Caixa",dataTable:null,selectedRow:null,despesas:[],entradas:[],isLoading:!1,totalDespesa:0,totalReceita:0,entradasColums:[{data:"descricao"},{data:null,render:e=>`${e.Estudante.nome}`},{data:"totalPrice",render:e=>`${(0,j.jq)(e,2,",",".")}`},{data:null,render:e=>`${e.User.nome}`},{data:"createdAt",render:e=>`${V()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")}`}],saidasColums:[{data:"descricao"},{data:"referencia"},{data:"valor",render:e=>`${(0,j.jq)(e,2,",",".")}`},{data:null,render:e=>`${e.User.nome}`},{data:"createdAt",render:e=>`${V()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")}`}],filter_data:{start_date:"",end_date:""},language:j.BH}},mounted(){},methods:{filterFluxo(){this.totalDespesa=0,this.totalReceita=0;const{start_date:e,end_date:t}=this.filter_data;e&&t?j.FH.get(`/fluxo-de-caixa/start/${e}/end/${t}`).then((e=>{this.despesas=e.data.saidas,this.entradas=e.data.entradas,e.data.saidas.map((e=>{this.totalDespesa+=e.valor})),e.data.entradas.map((e=>{this.totalReceita+=e.totalPrice}))})).catch((e=>{console.log(e)})):this.$swal.fire({title:"Notificação",icon:"warning",text:"Preencha todos os campos"})},async repairHistory(){const e=await this.$swal.fire({title:"Reparar Histórico?",text:"Isso irá gerar números e assinaturas digitais para todos os pagamentos pendentes. Esta ação é irreversível!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#f1f1f1",cancelButtonColor:"#d33",confirmButtonText:"Sim, reparar agora!",cancelButtonText:"Cancelar"});if(e.isConfirmed){this.isLoading=!0;try{const e=await j.FH.post("/pagamentos/admin/repair-history");await this.$swal.fire({title:"Concluído!",text:e.data.message,icon:"success"}),this.filter_data.start_date&&this.filterFluxo()}catch(t){console.error(t),this.$swal.fire({title:"Erro na Reparação",text:t.response?.data?.error||"Erro interno ao processar documentos.",icon:"error"})}finally{this.isLoading=!1}}},async exportSAFT(){const{start_date:e,end_date:t}=this.filter_data;if(!e||!t)return this.$swal.fire({title:"Atenção",icon:"warning",text:"Selecione o período para exportar o SAF-T"});this.isLoading=!0;try{const a=await j.FH.get("/pagamentos/export/saft",{params:{start_date:e,end_date:t},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([a.data])),o=document.createElement("a");o.href=s;const l=`SAFT_EXPORT_${e}_A_${t}.xml`;o.setAttribute("download",l),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(s),this.$swal.fire({title:"Sucesso",icon:"success",text:"Ficheiro SAF-T gerado com sucesso!"})}catch(a){console.error("Erro ao exportar SAF-T:",a),this.$swal.fire({title:"Erro",icon:"error",text:"Não foi possível gerar o ficheiro SAF-T. Verifique se existem documentos no período selecionado."})}finally{this.isLoading=!1}},gerarDocumento(){this.isLoading=!0;try{const e=new W["default"],{start_date:t,end_date:a}=this.filter_data,s=14;e.addImage(`${j.OZ}/api/mediafiles/castro.jpeg`,"JPEG",90,10,25,25),e.setFontSize(14),e.text("INSTITUTO POLITÉCNICO PRIVADO CASTRO",105,42,{align:"center"}),e.setFontSize(10),e.text('"A Luz do Saber"',105,48,{align:"center"}),e.setFontSize(12),e.setFont(void 0,"bold"),e.text("FLUXO DE CAIXA",105,58,{align:"center"}),e.setFontSize(10),e.setFont(void 0,"normal"),e.text(`Período: ${V()(t).format("DD/MM/YYYY")} à ${V()(a).format("DD/MM/YYYY")}`,105,65,{align:"center"}),e.setFont(void 0,"bold"),e.text("ENTRADAS",s,75),e.autoTable({startY:80,head:[["DESCRIÇÃO","ESTUDANTE","VALOR","FUNCIONÁRIO","DATA"]],body:this.entradas.map((e=>[e.descricao||"",e.Estudante?.nome||"",(0,j.jq)(e.totalPrice,2,",",".")+" Kz",e.User?.nome||"",V()(e.createdAt).format("DD-MM-YYYY HH:mm")])),theme:"grid",headStyles:{fillColor:[0,150,136]},styles:{fontSize:8,cellPadding:2}});let o=e.lastAutoTable.finalY+15;o>250&&(e.addPage(),o=20),e.setFont(void 0,"bold"),e.text("SAÍDAS",s,o),e.autoTable({startY:o+5,head:[["DESCRIÇÃO","REFERÊNCIA","VALOR","FUNCIONÁRIO","DATA"]],body:this.despesas.map((e=>[e.descricao||"",e.referencia||"",(0,j.jq)(e.valor,2,",",".")+" Kz",e.User?.nome||"",V()(e.createdAt).format("DD-MM-YYYY HH:mm")])),theme:"grid",headStyles:{fillColor:[0,150,136]},styles:{fontSize:8,cellPadding:2}}),o=e.lastAutoTable.finalY+15,o>240&&(e.addPage(),o=20);const l=this.totalReceita-this.totalDespesa;e.setFontSize(10),e.setFont(void 0,"normal"),e.text("TOTAL ENTRADAS:",s,o),e.text(`${(0,j.jq)(this.totalReceita,2,",",".")} Kz`,70,o),e.text("TOTAL SAÍDAS:",s,o+7),e.text(`${(0,j.jq)(this.totalDespesa,2,",",".")} Kz`,70,o+7),e.setFont(void 0,"bold"),e.text("SALDO A TRANSITAR:",s,o+15),e.text(`${(0,j.jq)(l,2,",",".")} Kz`,70,o+15);const r=e.internal.getNumberOfPages();for(let n=1;n<=r;n++)e.setPage(n),e.setFontSize(8),e.setFont(void 0,"normal"),e.text(`Página ${n} de ${r}`,105,290,{align:"center"}),n===r&&(e.setFont(void 0,"italic"),e.text("documento emitido por programa validado nº 330/AGT/2021",s,285));window.open(e.output("bloburl"),"_blank")}catch(e){console.error(e),this.$swal.fire("Erro","Erro ao processar o PDF localmente.","error")}finally{this.isLoading=!1}},generatePDF(){this.isLoading=!0;const{start_date:e,end_date:t}=this.filter_data;window.open(`${j.OZ}/api/documentos/fluxo-de-caixa/start/${e}/end/${t}`,"_blank"),this.isLoading=!1},moment:V(),numberFormat:j.jq}},Q=a(1241);const G=(0,Q.A)(J,[["render",P]]);var Z=G}}]);
//# sourceMappingURL=80.2a013525.js.map