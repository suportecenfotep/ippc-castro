"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[386],{524:function(e,a,t){t.d(a,{A:function(){return u}});var s=t(6768);const r={class:"text-center"},o=(0,s.Fv)('<div id="loading-wrapper"><div class="spinner"><div class="line1"></div><div class="line2"></div><div class="line3"></div><div class="line4"></div><div class="line5"></div><div class="line6"></div></div></div>',1),l=[o];function n(e,a,t,o,n,i){return(0,s.uX)(),(0,s.CE)("div",r,l)}var i={name:"loader_view"},d=t(1241);const c=(0,d.A)(i,[["render",n]]);var u=c},7113:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});var s=t(6768),r=t(5130),o=t(4232);const l={class:"page-wrapper"},n={class:"main-container"},i={class:"content-wrapper-scroll"},d={class:"content-wrapper"},c={class:"row"},u={class:"col-12"},p={class:"card p-2"},f={class:"row p-2"},m={class:"col-md-6"},L=(0,s.Lk)("label",{class:"mb-1"},"Selecione o período",-1),h=(0,s.Lk)("br",null,null,-1),A={class:"d-flex align-items-center"},b=(0,s.Lk)("b",{class:"me-1"},"DE",-1),v=(0,s.Lk)("b",{class:"mx-1"},"A",-1),k={class:"col-md-6"},g=(0,s.Lk)("label",{class:"text-white mb-1"},".",-1),x=(0,s.Lk)("br",null,null,-1),T=(0,s.Lk)("span",{class:"fas fa-search"},null,-1),F=(0,s.Lk)("span",{class:"fas fa-file-pdf"},null,-1),w=(0,s.Lk)("span",{class:"fas fa-file-code"},null,-1),S={class:"card"},D=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h5",null,"ENTRADAS")],-1),R={class:"card-body"},_=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"bg-secondary"},[(0,s.Lk)("th",null,"DESCRIÇÃO"),(0,s.Lk)("th",null,"ESTUDANTE"),(0,s.Lk)("th",null,"VALOR"),(0,s.Lk)("th",null,"FUNCIONARIO"),(0,s.Lk)("th",null,"DATA")])],-1),C={class:"card-footer"},y={class:"float-end"},E={class:"card"},O=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h5",null,"SAIDAS")],-1),I={class:"card-body"},Y=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"bg-secondary"},[(0,s.Lk)("th",null,"DESCRIÇÃO"),(0,s.Lk)("th",null,"REFERÊNCIA"),(0,s.Lk)("th",null,"VALOR"),(0,s.Lk)("th",null,"FUNCIONARIO"),(0,s.Lk)("th",null,"DATA")])],-1),N={class:"card-footer"},$={class:"float-end"};function U(e,a,t,U,H,P){const K=(0,s.g2)("Sidebar"),j=(0,s.g2)("Navbar"),q=(0,s.g2)("DataTable"),z=(0,s.g2)("Footer"),M=(0,s.g2)("Loader");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)(K),(0,s.Lk)("div",n,[(0,s.bF)(j,{page:"Tesouraria / Fluxo de Caixa"}),(0,s.Lk)("div",i,[(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[(0,s.Lk)("div",f,[(0,s.Lk)("div",m,[L,h,(0,s.Lk)("div",A,[b,(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>H.filter_data.start_date=e)},null,512),[[r.Jo,H.filter_data.start_date]]),v,(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>H.filter_data.end_date=e)},null,512),[[r.Jo,H.filter_data.end_date]])])]),(0,s.Lk)("div",k,[g,x,(0,s.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>P.filterFluxo&&P.filterFluxo(...e)),class:"btn btn-info text-uppercase fw-bold"},[T,(0,s.eW)(" Filtrar ")]),H.entradas.length>0?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a[3]||(a[3]=(...e)=>P.generatePDF&&P.generatePDF(...e)),class:"btn btn-danger mx-2 text-uppercase fw-bold"},[F,(0,s.eW)(" Imprimir ")])):(0,s.Q3)("",!0),H.entradas.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:a[4]||(a[4]=(...e)=>P.exportSAFT&&P.exportSAFT(...e)),class:"btn btn-success text-uppercase fw-bold"},[w,(0,s.eW)(" Exportar SAF-T ")])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",S,[D,(0,s.Lk)("div",R,[(0,s.bF)(q,{ref:"table",data:H.entradas,columns:H.entradasColums,options:{select:!0,language:H.language},class:"display table table-striped table-bordered"},{default:(0,s.k6)((()=>[_])),_:1},8,["data","columns","options"])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",y,[(0,s.Lk)("p",null,[(0,s.eW)("Resultado: "),(0,s.Lk)("b",null,(0,o.v_)(P.numberFormat(H.totalReceita,2,",","."))+"Kz",1)])])])]),(0,s.Lk)("div",E,[O,(0,s.Lk)("div",I,[(0,s.bF)(q,{ref:"table",data:H.despesas,columns:H.saidasColums,options:{select:!0,language:H.language},class:"display table table-striped table-bordered"},{default:(0,s.k6)((()=>[Y])),_:1},8,["data","columns","options"])]),(0,s.Lk)("div",N,[(0,s.Lk)("div",$,[(0,s.Lk)("p",null,[(0,s.eW)("Resultado: "),(0,s.Lk)("b",null,(0,o.v_)(P.numberFormat(H.totalDespesa,2,",","."))+"Kz",1)])])])])])])]),(0,s.bF)(z)]),H.isLoading?((0,s.uX)(),(0,s.Wv)(M,{key:0})):(0,s.Q3)("",!0)])])}t(4603),t(7566),t(8721);var H=t(7532),P=t(3213),K=t(3936),j=t(524),q=t(9715),z=t(9148),M=t.n(z),V=t(903),X=t(9995),B=t(3786),W=t(1749);t(5839);V.A.use(X.A),V.A.use(B.A);var J={name:"fluxo_de_caixa_view",components:{Sidebar:H.A,Navbar:P.A,Footer:K.A,Loader:j.A,DataTable:V.A},data(){return{title:"Fluxo de Caixa",dataTable:null,selectedRow:null,despesas:[],entradas:[],isLoading:!1,totalDespesa:0,totalReceita:0,entradasColums:[{data:"descricao"},{data:null,render:e=>`${e.Estudante.nome}`},{data:"totalPrice",render:e=>`${(0,q.jq)(e,2,",",".")}`},{data:null,render:e=>`${e.User.nome}`},{data:"createdAt",render:e=>`${M()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")}`}],saidasColums:[{data:"descricao"},{data:"referencia"},{data:"valor",render:e=>`${(0,q.jq)(e,2,",",".")}`},{data:null,render:e=>`${e.User.nome}`},{data:"createdAt",render:e=>`${M()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")}`}],filter_data:{start_date:"",end_date:""},language:q.BH}},mounted(){},methods:{filterFluxo(){this.totalDespesa=0,this.totalReceita=0;const{start_date:e,end_date:a}=this.filter_data;e&&a?q.FH.get(`/fluxo-de-caixa/start/${e}/end/${a}`).then((e=>{this.despesas=e.data.saidas,this.entradas=e.data.entradas,e.data.saidas.map((e=>{this.totalDespesa+=e.valor})),e.data.entradas.map((e=>{this.totalReceita+=e.totalPrice}))})).catch((e=>{console.log(e)})):this.$swal.fire({title:"Notificação",icon:"warning",text:"Preencha todos os campos"})},async repairHistory(){const e=await this.$swal.fire({title:"Reparar Histórico?",text:"Isso irá gerar números e assinaturas digitais para todos os pagamentos pendentes. Esta ação é irreversível!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#f1f1f1",cancelButtonColor:"#d33",confirmButtonText:"Sim, reparar agora!",cancelButtonText:"Cancelar"});if(e.isConfirmed){this.isLoading=!0;try{const e=await q.FH.post("/pagamentos/admin/repair-history");await this.$swal.fire({title:"Concluído!",text:e.data.message,icon:"success"}),this.filter_data.start_date&&this.filterFluxo()}catch(a){console.error(a),this.$swal.fire({title:"Erro na Reparação",text:a.response?.data?.error||"Erro interno ao processar documentos.",icon:"error"})}finally{this.isLoading=!1}}},async exportSAFT(){const{start_date:e,end_date:a}=this.filter_data;if(!e||!a)return this.$swal.fire({title:"Atenção",icon:"warning",text:"Selecione o período para exportar o SAF-T"});this.isLoading=!0;try{const t=await q.FH.get("/pagamentos/export/saft",{params:{start_date:e,end_date:a},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s;const o=`SAFT_EXPORT_${e}_A_${a}.xml`;r.setAttribute("download",o),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s),this.$swal.fire({title:"Sucesso",icon:"success",text:"Ficheiro SAF-T gerado com sucesso!"})}catch(t){console.error("Erro ao exportar SAF-T:",t),this.$swal.fire({title:"Erro",icon:"error",text:"Não foi possível gerar o ficheiro SAF-T. Verifique se existem documentos no período selecionado."})}finally{this.isLoading=!1}},gerarDocumento(){this.isLoading=!0;const e=new W["default"],a=[{header:"DESCRIÇÃO",dataKey:"descricao"},{header:"ESTUDANTE",dataKey:"estudante"},{header:"VALOR",dataKey:"totalPrice"},{header:"FUNCIONÁRIO",dataKey:"funcionario"},{header:"DATA",dataKey:"createdAt"}],t=[{header:"DESCRIÇÃO",dataKey:"descricao"},{header:"REFERÊNCIA",dataKey:"referencia"},{header:"VALOR",dataKey:"valor"},{header:"FUNCIONÁRIO",dataKey:"funcionario"},{header:"DATA",dataKey:"createdAt"}],s=this.entradas.map((e=>({descricao:e.descricao||"",estudante:e.Estudante?.nome||"",totalPrice:(0,q.jq)(e.totalPrice,2,",","."),funcionario:e.User?.nome||"",createdAt:M()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")||""}))),r=this.despesas.map((e=>({descricao:e.descricao||"",referencia:e.referencia||"",valor:(0,q.jq)(e.valor,2,",","."),funcionario:e.User?.nome||"",createdAt:M()(e.createdAt).format("DD-MM-YYYY HH:mm:ss")||""})));e.addImage(`${q.OZ}/api/mediafiles/castro.jpeg`,"JPEG",90,15,25,25),e.setFontSize(12),e.text("INSTITUTO POLITÉCNICO PRIVADO CASTRO",58,50),e.text('"A Luz do Saber"',85,56),e.setFontSize(14),e.text("FLUXO DE CAIXA",20,64),e.setFontSize(12),e.text("ENTRADAS",20,80),e.autoTable({columns:a,body:s,margin:{top:90},theme:"grid"}),e.setFontSize(12),e.text("SAÍDAS",20,e.autoTable.previous.finalY+20),e.autoTable({columns:t,body:r,margin:{top:90},theme:"grid"});const o=this.totalReceita,l=this.totalDespesa,n=o-l;e.setFontSize(12),e.text("TOTAL ENTRADAS:",20,e.autoTable.previous.finalY+20),e.text((0,q.jq)(o,2,",","."),120,e.autoTable.previous.finalY+20),e.text("TOTAL SAÍDAS:",20,e.autoTable.previous.finalY+30),e.text((0,q.jq)(l,2,",","."),120,e.autoTable.previous.finalY+30),e.text("SALDO A TRANSITAR:",20,e.autoTable.previous.finalY+40),e.text((0,q.jq)(n,2,",","."),120,e.autoTable.previous.finalY+40),this.isLoading=!1,e.output("dataurlnewwindow")},generatePDF(){this.isLoading=!0;const{start_date:e,end_date:a}=this.filter_data;window.open(`${q.OZ}/api/documentos/fluxo-de-caixa/start/${e}/end/${a}`,"_blank"),this.isLoading=!1},moment:M(),numberFormat:q.jq}},Q=t(1241);const Z=(0,Q.A)(J,[["render",U]]);var G=Z}}]);
//# sourceMappingURL=386.ba96475b.js.map